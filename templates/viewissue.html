{% extends "bootstrap/base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}
Issue Tracker
{% endblock %}

{% block content %}

    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

</head>

<style>
    #collapseOne
    {
        overflow-y: scroll !important;
        max-height: 400px !important;
    }
</style>

<div class="container-fluid">
	<div class="row">
		<div class="col-md-12">

			<nav class="navbar navbar-inverse">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <a class="navbar-brand" href="/">Network iTC Tracker</a>
                    </div>
                    <ul class="nav navbar-nav">
                        <li class="dropdown">
							 <a href="#" class="dropdown-toggle" data-toggle="dropdown">Issues<strong class="caret"></strong></a>
							<ul class="dropdown-menu">
								<li>
									<a href="allissues">All Issues</a>
								</li>
								<li>
									<a href="openissues">Open Issues</a>
								</li>
								<li>
									<a href="resissues">Resolved Issues</a>
								</li>
								<li class="divider">
								</li>
								<li>
									<a href="myissues">My Issues</a>
								</li>
								<li>
									<a href="#">One more separated link</a>
								</li>
							</ul>
						</li>
                        <li><a href="newissue">New Issue</a></li>
                        <li><a href="roadmap">Roadmap</a></li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ current_user.email }}<strong class="caret"></strong></a>
							<ul class="dropdown-menu">
                                <li><a href="#"><span class="glyphicon glyphicon-user"></span> My Account</a></li>
                                <li class="divider">
								</li>
                                <li><a href="/logout"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
	</div>

    <!-- Row 2 -->

    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-8">
            <h3>View Issue - #{{ id }}</h3>
        </div>
        <div class="col-md-2"></div>
    </div>

    <!-- Row 3 -->

    <form method="POST" action="/updateissue?id={{ id }}">
        <div class="row">
            <!--<div class="col-md-2"></div>-->
            <div class="col-md-1"></div>
            <div class="form-group col-md-5">
                {{ form.title.label }} {{ form.title(class="edit-class form-control", readonly=true) }}
            </div>
            <div class="form-group col-md-5">
                {{ form.raised_by.label }} {{ form.raised_by(class="form-control", readonly=true) }}
            </div>
            <div class="col-md-1"></div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="form-group col-md-10">
                {{ form.desc.label }} {{ form.desc(class="edit-class form-control", readonly=true) }}
            </div>
            <div class="col-md-1"></div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="form-group col-md-2">
                {{ form.sev.label }} {{ form.sev(class="edit-class form-control", readonly=true) }}
            </div>
            <div class="form-group col-md-2">
                {{ form.state.label }} {{ form.state(class="edit-class form-control", readonly=true) }}
            </div>
            <div class="form-group col-md-2">
                {{ form.impact_doc.label }} {{ form.impact_doc(class="edit-class form-control", readonly=true) }}
            </div>
            <div class="form-group col-md-2">
                {{ form.impact_ver.label }} {{ form.impact_ver(class="edit-class form-control", readonly=true) }}
            </div>
            <div class="form-group col-md-2">
                {{ form.area.label }} {{ form.area(class="edit-class form-control", readonly=true) }}
            </div>
            <div class="col-md-1"></div>
        </div>

        <div class="row">
            <div class="col-md-1"></div>
            <div class="form-group col-md-10">
                {{ form.prop_res.label }} {{ form.prop_res(class="edit-class form-control", readonly=true) }}
            </div>
        </div>



        {% if comments|length > 0 %}
            <div class="row">
                <div class="col-md-1"></div>
                <div class="col-md-10">
                <div class=panel-group" id="accordion">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne"><span class="glyphicon glyphicon-comment">
                            </span> Comments</a>
                            </h4>
                        </div>

                    <div id="collapseOne" class="panel-collapse collapse">
                            <div class="panel-body">
                                {% for comment in comments %}
                                <div class="row">
                                    <div class="col-md-1"></div>
                                    <div class="form-group col-md-10">
                                        <label for="old-comment-box">Comment from {{ comment ['user_id'] }} on {{ comment['date'] }}</label> <textarea class="form-control" id="old-comment-box" name="old-comment-box" readonly>{{ comment['comment'] }}</textarea>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                    </div>
                </div>
            </div>
                </div>
            </div>
        {% endif %}

        <div class="row hidden" id="comment-box">
            <div class="col-md-1"></div>
            <div class="form-group col-md-10">
                {{ form.comment.label }} {{ form.comment(class="form-control") }}
            </div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="form-group col-md-4">
                <button id="update" type="submit" class="btn btn-primary hidden" name="update">Save</button>


                <button id="edit" type="button" class="btn btn-success" name="edit">Edit</button>
                <button id="cancel" type="button" class="btn btn-danger hidden" name="cancel">Cancel</button>
                <button id="commentbtn" type="button" class="btn btn-primary" name="comment">Add Comment</button>
            </div>
        </div>
    </form>
</div>

    <script>
        $(document).ready(function()
        {
            $("#edit").click(function()
                {
                    $(".edit-class").prop("readonly", false);
                    $("#update").removeClass("hidden");
                    $("#cancel").removeClass("hidden");

                    $("#commentbtn").addClass("hidden");
                    $("#edit").addClass("hidden");
                });

            $("#cancel").click(function()
                {
                    $(".edit-class").prop("readonly", true);
                    $("#comment-box").addClass("hidden");
                    $("#update").addClass("hidden");
                    $("#cancel").addClass("hidden");

                    $("#commentbtn").removeClass("hidden");
                    $("#edit").removeClass("hidden");
                });
            $("#commentbtn").click(function()
                {
                     $("#comment-box").removeClass("hidden");
                     $("#cancel").removeClass("hidden");
                     $("#update").removeClass("hidden");

                     $("#commentbtn").addClass("hidden");
                     $("#edit").addClass("hidden");
                });
        });

    </script>

{% endblock %}